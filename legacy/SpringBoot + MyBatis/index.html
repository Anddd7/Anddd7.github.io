<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Anddd7"><title>SpringBoot + MyBatis 重构 Web 应用 · Anddd7's Planet</title><meta name="description" content="前言　项目构建的时候是截取了另一个项目的部分功能形成的，截取出的功能代码少但项目结构比较复杂，依赖严重 。改写过后，不少代码成了”鸡肋”，搞不清楚谁是谁 。
 web/controller在一块，dao/domain独占一方 ; junit在6个pom。xml中出现了4次，版本还不一样 ; spri"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/assets/avatar.jpeg" style="width:127px;"><h3 title=""><a href="/">Anddd7's Planet</a></h3><div class="description"><p>Level Up! Programmer~</p></div></div></div><ul class="social-links"><li><a href="http://github.com/Anddd7"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Nice Theme of </span></a><a href="https://github.com/Ben02/hexo-theme-Anatole">Anatole</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/about">关于</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/assets/avatar.jpeg"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>SpringBoot + MyBatis 重构 Web 应用</a></h3></div><div class="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>　项目构建的时候是截取了另一个项目的部分功能形成的，截取出的功能代码少但项目结构比较复杂，依赖严重 。改写过后，不少代码成了”鸡肋”，搞不清楚谁是谁 。</p>
<p> web/controller在一块，dao/domain独占一方 ; junit在6个pom。xml中出现了4次，版本还不一样 ; spring/mybatis的配置文件也有好几个，里面的xml代码也是长而杂 。</p>
<p> <strong>Clean Code</strong>，之前专门买了一本书，讲述代码清洁之道 。 <strong>整洁的代码对项目的开发效率至关重要</strong>，宏观一点，项目结构的清晰，也对后续的开发有所帮助。</p>
<h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><blockquote>
</blockquote>
<p>  GitHub示例 <a href="https://github.com/Anddd7/SSM-SpringBoot-Starter" target="_blank" rel="noopener">Anddd7/SSM-SpringBoot-Starter</a>`</p>
<p> 前一段时间还没正式学习使用Spring时就听说了SpringBoot，还记得学生时代配置SSH，满篇的xml简直是童年阴影(- -如果xml节点还没对齐的话， 那 ……)。  <br><br> SpringBoot可以达到0配置 (- -当然这是不可能的) 快速启动一个Spring应用，对简化配置有显著提升。</p>
<h1 id="准备-pom-xml"><a href="#准备-pom-xml" class="headerlink" title="准备 - pom.xml"></a>准备 - pom.xml</h1><ul>
<li>首先还是从Maven配置入手</li>
</ul>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="keyword">lt</span>;?<span class="keyword">xml</span> <span class="title">version</span>=<span class="string">"1.0"</span> <span class="attr">encoding=</span><span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&amp;<span class="keyword">lt</span>;project <span class="attr">xmlns=</span><span class="string">"http://maven.apache.org/POM/4.0.0"</span></span><br><span class="line">         xmlns:<span class="attr">xsi=</span><span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">         xsi:<span class="attr">schemaLocation=</span><span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;modelVersion&gt;<span class="number">4.0</span>.<span class="number">0</span>&amp;<span class="keyword">lt</span>;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="keyword">lt</span>;groupId&gt;anddd7.boot4ssh&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;artifactId&gt;SSM-SpringBoot-Starter&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&gt;<span class="number">1.0</span>-SNAPSHOT&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;packaging&gt;jar&amp;<span class="keyword">lt</span>;/packaging&gt;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="keyword">lt</span>;!--官方推荐使用 spring-boot-starter-parent 包括一些预设配置:</span><br><span class="line">        <span class="number">1</span>.使用java6编译级别&amp;<span class="keyword">lt</span>;java.<span class="keyword">version</span>&gt;<span class="number">1.8</span>&amp;<span class="keyword">lt</span>;/java.<span class="keyword">version</span>&gt;</span><br><span class="line">        <span class="number">2</span>.使用utf-<span class="number">8</span>编码&amp;<span class="keyword">lt</span>;project.build.sourceEncoding&gt;UTF-<span class="number">8</span>&amp;<span class="keyword">lt</span>;/project.build.sourceEncoding&gt;</span><br><span class="line">        <span class="number">3</span>.实现了通用的测试框架 (JUnit, Hamcrest, Mockito).</span><br><span class="line">        <span class="number">4</span>.智能资源过滤</span><br><span class="line">        <span class="number">5</span>.智能的插件配置(exec plugin, surefire, Git commit ID, shade).</span><br><span class="line"></span><br><span class="line">        不继承也可使用dependcy引入 ,因为scope是import,不再允许在&amp;<span class="keyword">lt</span>;properties&gt;覆盖第三方包版本</span><br><span class="line">        如果要使用其他版本，需要在上面的前面添加一个完整的dependency</span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&gt;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&gt;spring-boot-dependencies&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&gt;<span class="number">1.4</span>.<span class="number">0</span>.RELEASE&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">type</span>&gt;pom&amp;<span class="keyword">lt</span>;/<span class="keyword">type</span>&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;scope&gt;import&amp;<span class="keyword">lt</span>;/scope&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&gt;</span><br><span class="line">    --&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;parent&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;groupId&gt;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;artifactId&gt;spring-boot-starter-parent&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&gt;RELEASE&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;relativePath/&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;/parent&gt;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="keyword">lt</span>;properties&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;project.build.sourceEncoding&gt;UTF-<span class="number">8</span>&amp;<span class="keyword">lt</span>;/project.build.sourceEncoding&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;java.<span class="keyword">version</span>&gt;<span class="number">1.8</span>&amp;<span class="keyword">lt</span>;/java.<span class="keyword">version</span>&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;mybatis.<span class="keyword">version</span>&gt;<span class="number">3.4</span>.<span class="number">2</span>&amp;<span class="keyword">lt</span>;/mybatis.<span class="keyword">version</span>&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;mybatis-spring.<span class="keyword">version</span>&gt;<span class="number">1.3</span>.<span class="number">1</span>&amp;<span class="keyword">lt</span>;/mybatis-spring.<span class="keyword">version</span>&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;spring-boot.<span class="keyword">version</span>&gt;<span class="number">1.4</span>.<span class="number">4</span>.RELEASE&amp;<span class="keyword">lt</span>;/spring-boot.<span class="keyword">version</span>&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="keyword">lt</span>;!-- 对应模块的starter包含常用依赖 ,例如starter-web&#123;spring-web,spring-mvc&#125;--&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;dependencies&gt;</span><br><span class="line"></span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&gt;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&gt;spring-boot-starter-web&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&gt;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&gt;spring-boot-dependencies&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&gt;$&#123;spring-boot.<span class="keyword">version</span>&#125;&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">type</span>&gt;pom&amp;<span class="keyword">lt</span>;/<span class="keyword">type</span>&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;scope&gt;import&amp;<span class="keyword">lt</span>;/scope&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&gt;org.mybatis&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&gt;mybatis&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&gt;$&#123;mybatis.<span class="keyword">version</span>&#125;&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&gt;org.mybatis&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&gt;mybatis-spring&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&gt;$&#123;mybatis-spring.<span class="keyword">version</span>&#125;&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &amp;<span class="keyword">lt</span>;!-- springboot+mybatis官方连接包 --&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&gt;org.mybatis.spring.boot&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&gt;mybatis-spring-boot-autoconfigure&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&gt;<span class="number">1.1</span>.<span class="number">1</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&gt;org.mybatis.spring.boot&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&gt;mybatis-spring-boot-starter&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&gt;<span class="number">1.1</span>.<span class="number">1</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &amp;<span class="keyword">lt</span>;!-- dbcp 数据源 --&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&gt;commons-dbcp&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&gt;commons-dbcp&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&gt;<span class="number">1.4</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&gt;mysql&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&gt;mysql-connector-java&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&gt;<span class="number">5.1</span>.<span class="number">38</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="keyword">lt</span>;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="keyword">lt</span>;build&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;plugins&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;!--用于将项目打包成fat jar（executable jar）--&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;plugin&gt;</span><br><span class="line">                &amp;<span class="keyword">lt</span>;groupId&gt;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">                &amp;<span class="keyword">lt</span>;artifactId&gt;spring-boot-maven-plugin&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;/plugin&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;!-- mybatis 工具 --&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;plugin&gt;</span><br><span class="line">                &amp;<span class="keyword">lt</span>;groupId&gt;org.mybatis.generator&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">                &amp;<span class="keyword">lt</span>;artifactId&gt;mybatis-generator-maven-plugin&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">                &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&gt;<span class="number">1.3</span>.<span class="number">2</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&gt;</span><br><span class="line">                &amp;<span class="keyword">lt</span>;configuration&gt;</span><br><span class="line">                    &amp;<span class="keyword">lt</span>;verbose&gt;<span class="literal">true</span>&amp;<span class="keyword">lt</span>;/verbose&gt;</span><br><span class="line">                    &amp;<span class="keyword">lt</span>;overwrite&gt;<span class="literal">true</span>&amp;<span class="keyword">lt</span>;/overwrite&gt;</span><br><span class="line">                &amp;<span class="keyword">lt</span>;/configuration&gt;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;/plugin&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/plugins&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;/build&gt;</span><br><span class="line">&amp;<span class="keyword">lt</span>;/project&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果使用Jetty ，需要替换掉内置的Tomcat </li>
</ul>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="keyword">lt</span>;dependency&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;groupId&gt;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;artifactId&gt;spring-boot-starter-web&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&gt;$&#123;spring-boot.<span class="keyword">version</span>&#125;&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;!-- 使用jetty启动 ,先移除tomcat组件 --&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;exclusions&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;exclusion&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;groupId&gt;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;artifactId&gt;spring-boot-starter-tomcat&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/exclusion&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;/exclusions&gt;</span><br><span class="line">&amp;<span class="keyword">lt</span>;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&amp;<span class="keyword">lt</span>;!-- 添加jetty支持 --&gt;</span><br><span class="line">&amp;<span class="keyword">lt</span>;dependency&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;groupId&gt;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;artifactId&gt;spring-boot-starter-jetty&amp;<span class="keyword">lt</span>;/artifactId&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&gt;$&#123;spring-boot.<span class="keyword">version</span>&#125;&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&gt;</span><br><span class="line">&amp;<span class="keyword">lt</span>;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h1 id="开始-Application-和-Configuration"><a href="#开始-Application-和-Configuration" class="headerlink" title="开始 - Application 和 Configuration"></a>开始 - Application 和 Configuration</h1><blockquote>
</blockquote>
<p>引入Maven后 ，准备一个Controller ，然后通过SpringApplication启动Spring就可以使用了 <a href="http://blog.csdn.net/xiaoyu411502/article/details/47864969" target="_blank" rel="noopener">Spring Boot 快速入门 </a>；需要对Spring进行一些配置的时候（和Mybatis融合、配置数据源等）就需要将Application单独出来 。</p>
<ul>
<li>1 Spring配置application.xml -&gt; application.yaml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yaml</span></span><br><span class="line"><span class="comment"># Server settings (ServerProperties)</span></span><br><span class="line"><span class="comment"># 以数据为中心的标记语言 ,易于读写 ,替代xml</span></span><br><span class="line"><span class="comment"># springboot 默认是8080端口 ,没有项目地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器设置</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">  address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="attr">  sessionTimeout:</span> <span class="number">30</span></span><br><span class="line"><span class="attr">  contextPath:</span> <span class="string">/testboot</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 内置tomcat设置</span></span><br><span class="line"><span class="attr">tomcat:</span></span><br><span class="line"><span class="attr">  accessLogEnabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  protocolHeader:</span> <span class="string">x-forwarded-proto</span></span><br><span class="line"><span class="attr">  remoteIpHeader:</span> <span class="string">x-forwarded-for</span></span><br><span class="line"><span class="attr">  basedir:</span></span><br><span class="line"><span class="attr">  backgroundProcessorDelay:</span> <span class="number">30</span> <span class="comment"># secs</span></span><br></pre></td></tr></table></figure>
<ul>
<li>2 设置SpringBoot启动入口</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> anddd7.springboot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> anddd7.springboot.configuration.MapperScannerConfiguration;</span><br><span class="line"><span class="keyword">import</span> anddd7.springboot.configuration.MyBatisConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将spring的启动和配置单独出来</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@SpringBootApplication</span> 等价于 :</span></span><br><span class="line"><span class="comment"> * -     <span class="doctag">@Configuration</span> 通过<span class="doctag">@ImportResource</span>引入xml文件,<span class="doctag">@Value</span>读取键值 ,<span class="doctag">@Bean</span>读取配置的bean实例</span></span><br><span class="line"><span class="comment"> * -     <span class="doctag">@ComponentScan</span> 同xml中的自动扫描组件</span></span><br><span class="line"><span class="comment"> * -     <span class="doctag">@EnableAutoConfiguration</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@EnableAutoConfiguration</span> 下包含了一系列自动配置类的清单 ,并按顺序执行 ,在Spring3时代就有<span class="doctag">@EnableWebMvc</span>注解</span></span><br><span class="line"><span class="comment"> * [SpringBoot之<span class="doctag">@EnableAutoConfiguration</span>原理及自定义扩展 ](http://blog.csdn.net/xiaoyu411502/article/details/52770723)</span></span><br><span class="line"><span class="comment"> * &amp;lt;p&gt;</span></span><br><span class="line"><span class="comment"> * MongoAutoConfiguration.class为例 :</span></span><br><span class="line"><span class="comment"> * -    使用了<span class="doctag">@Configuration</span> ,标识是一个配置</span></span><br><span class="line"><span class="comment"> * -    定义了必要的Mongo对象<span class="doctag">@Bean</span></span></span><br><span class="line"><span class="comment"> * -    使用了<span class="doctag">@EnableConfigurationProperties</span> ,将application.properties配置文件中的属性映射到Java类中 ,便于使用</span></span><br><span class="line"><span class="comment"> * -    <span class="doctag">@ConditionOnClass</span>表明加载条件 - Mongo.class位于类路径上</span></span><br><span class="line"><span class="comment"> * -    <span class="doctag">@ConditionalOnMissingBean</span>说明Spring Boot仅仅在当前上下文中不存在Mongo对象时，才会实例化一个Bean</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Import</span>(&#123;MyBatisConfiguration.<span class="keyword">class</span>, MapperScannerConfiguration.<span class="keyword">class</span>&#125;)</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//一键自动启动</span></span><br><span class="line">        SpringApplication.run(Application.<span class="keyword">class</span>, args);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//配置启动</span></span><br><span class="line"><span class="comment">//        SpringApplication app = new SpringApplication();</span></span><br><span class="line"><span class="comment">//        app.setBannerMode(Banner.Mode.OFF);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//链式API构建器</span></span><br><span class="line"><span class="comment">//        new SpringApplicationBuilder()</span></span><br><span class="line"><span class="comment">//                .bannerMode(Banner.Mode.OFF)</span></span><br><span class="line"><span class="comment">//                .child(Application.class)</span></span><br><span class="line"><span class="comment">//                .run();</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
</blockquote>
<p><strong>依旧是@SpringBootApplication，只不过@Import了一些配置类，使用过xml配置Mybatis和Spring的童鞋对这些类名一定很熟悉，其实就是将原来xml转化为了Java类配置 — <a href="http://www.w2bc.com/article/177173" target="_blank" rel="noopener">@Configuration注解</a></strong></p>
<ul>
<li>3.1 数据源</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> anddd7.springboot.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbcp.BasicDataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.<span class="keyword">annotation</span>.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.PropertySource;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对应xml中datasource的配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(<span class="meta-string">"classpath:prop.properties"</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(<span class="meta-string">"<span class="subst">$&#123;jdbc.driver&#125;</span>"</span>)</span></span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="meta">@Value(<span class="meta-string">"<span class="subst">$&#123;jdbc.url&#125;</span>"</span>)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value(<span class="meta-string">"<span class="subst">$&#123;jdbc.username&#125;</span>"</span>)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@Value(<span class="meta-string">"<span class="subst">$&#123;jdbc.password&#125;</span>"</span>)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="meta">@Value(<span class="meta-string">"<span class="subst">$&#123;jdbc.maxActive&#125;</span>"</span>)</span></span><br><span class="line">    <span class="keyword">private</span> int maxActive;</span><br><span class="line">    <span class="meta">@Value(<span class="meta-string">"<span class="subst">$&#123;jdbc.maxIdel&#125;</span>"</span>)</span></span><br><span class="line">    <span class="keyword">private</span> int maxIdel;</span><br><span class="line">    <span class="meta">@Value(<span class="meta-string">"<span class="subst">$&#123;jdbc.maxWait&#125;</span>"</span>)</span></span><br><span class="line">    <span class="keyword">private</span> long maxWait;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = <span class="meta-string">"dataSource"</span>)</span></span><br><span class="line">    <span class="keyword">public</span> BasicDataSource dataSource() &#123;</span><br><span class="line">        BasicDataSource dataSource = new BasicDataSource();</span><br><span class="line">        dataSource.setDriverClassName(driver);</span><br><span class="line">        dataSource.setUrl(url);</span><br><span class="line">        dataSource.setUsername(username);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line">        dataSource.setMaxActive(maxActive);</span><br><span class="line">        dataSource.setMaxIdle(maxIdel);</span><br><span class="line">        dataSource.setMaxWait(maxWait);</span><br><span class="line">        dataSource.setValidationQuery(<span class="string">"SELECT 1"</span>);</span><br><span class="line">        dataSource.setTestOnBorrow(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>3.2 prop.properties</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#jdbc</span></span><br><span class="line">jdbc.<span class="attribute">driver</span>=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.<span class="attribute">url</span>=jdbc:mysql://localhost:3306/testdb?useUnicode=true&amp;amp;characterEncoding=utf8</span><br><span class="line">jdbc.<span class="attribute">username</span>=root</span><br><span class="line">jdbc.<span class="attribute">password</span>=214124</span><br><span class="line">jdbc.<span class="attribute">maxActive</span>=2335</span><br><span class="line">jdbc.<span class="attribute">maxIdel</span>=120</span><br><span class="line">jdbc.<span class="attribute">maxWait</span>=100</span><br></pre></td></tr></table></figure>
<ul>
<li>4 MapperScanner</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> anddd7.springboot.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.mapper.MapperScannerConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.AutoConfigureAfter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 扫描mybatis的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// 因为这个对象的扫描，需要在MyBatisConfig的后面注入，所以加上下面的注解</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(MyBatisConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapperScannerConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean(name = <span class="meta-string">"mapperScannerConfigurer"</span>)</span></span><br><span class="line">    <span class="keyword">public</span> MapperScannerConfigurer mapperScannerConfigurer() &#123;</span><br><span class="line">        <span class="comment">//创建内置的config</span></span><br><span class="line">        MapperScannerConfigurer mapperScannerConfigurer = new MapperScannerConfigurer();</span><br><span class="line">        <span class="comment">//获取之前注入的beanName为sqlSessionFactory的对象</span></span><br><span class="line">        mapperScannerConfigurer.setSqlSessionFactoryBeanName(<span class="string">"sqlSessionFactory"</span>);</span><br><span class="line">        <span class="comment">//指定mapper接口的路径 ,批量加上@Mapper ,也可以手动加上 ,省略此配置</span></span><br><span class="line">        <span class="comment">//会触发 No MyBatis mapper was found in '[anddd7.springboot.controller, anddd7.springboot]' package.  警告</span></span><br><span class="line">        <span class="comment">//mapperScannerConfigurer.setBasePackage("anddd7.springboot.dao");</span></span><br><span class="line">        <span class="keyword">return</span> mapperScannerConfigurer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>5.1 SqlSessionFactory</li>
</ul>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> anddd7.springboot.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.DefaultResourceLoader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.ResourceLoader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.ResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DataSourceTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.PlatformTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.TransactionManagementConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对应xml中事务和sqlSessionFactory的配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@Import</span>(DataSourceConfiguration.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfiguration</span> <span class="keyword">implements</span> <span class="title">TransactionManagementConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">PlatformTransactionManager <span class="title">annotationDrivenTransactionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"sqlSessionFactory"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="function">SqlSessionFactory <span class="title">sqlSessionFactoryBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SqlSessionFactoryBean bean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">        <span class="comment">//设置数据源</span></span><br><span class="line">        bean.setDataSource(dataSource);</span><br><span class="line">        <span class="comment">//设置config路径</span></span><br><span class="line">        ResourceLoader resourceLoader = <span class="keyword">new</span> DefaultResourceLoader();</span><br><span class="line">        bean.setConfigLocation(resourceLoader.getResource(<span class="string">"classpath:mybatis-configuration.xml "</span>));</span><br><span class="line">        <span class="comment">//设置mapper.xml路径</span></span><br><span class="line">        ResourcePatternResolver resolver = <span class="keyword">new</span> PathMatchingResourcePatternResolver();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bean.setMapperLocations(resolver.getResources(<span class="string">"classpath:anddd7/springboot/mapping/*.xml"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="function"><span class="keyword">return</span> bean.<span class="title">getObject</span><span class="params">()</span></span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">SqlSessionTemplate <span class="title">sqlSessionTemplate</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>5.2  mybatis-configuration.xml</li>
</ul>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="keyword">lt</span>;?<span class="keyword">xml</span> <span class="title">version</span>=<span class="string">"1.0"</span> <span class="attr">encoding=</span><span class="string">"UTF-8"</span> ?&gt;</span><br><span class="line">&amp;<span class="keyword">lt</span>;!DOCTYPE configuration</span><br><span class="line">    PUBLIC <span class="string">"-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line">    <span class="string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span><br><span class="line">&amp;<span class="keyword">lt</span>;configuration&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;settings&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;setting <span class="attr">name=</span><span class="string">"cacheEnabled"</span> <span class="attr">value=</span><span class="string">"false"</span> /&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;setting <span class="attr">name=</span><span class="string">"lazyLoadingEnabled"</span> <span class="attr">value=</span><span class="string">"false"</span> /&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;setting <span class="attr">name=</span><span class="string">"multipleResultSetsEnabled"</span> <span class="attr">value=</span><span class="string">"true"</span> /&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;setting <span class="attr">name=</span><span class="string">"useColumnLabel"</span> <span class="attr">value=</span><span class="string">"true"</span> /&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;setting <span class="attr">name=</span><span class="string">"useGeneratedKeys"</span> <span class="attr">value=</span><span class="string">"false"</span> /&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;setting <span class="attr">name=</span><span class="string">"defaultExecutorType"</span> <span class="attr">value=</span><span class="string">"SIMPLE"</span> /&gt;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;setting <span class="attr">name=</span><span class="string">"defaultStatementTimeout"</span> <span class="attr">value=</span><span class="string">"25000"</span> /&gt;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;/settings&gt;</span><br><span class="line">&amp;<span class="keyword">lt</span>;/configuration&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>6 除了application.xml还以properties或yaml存在，其他配置都Java化了，web.xml自然也不存在了（顺应servlet 3.0的注解方式）。</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> anddd7.springboot.configuration;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> anddd7.springboot.filter.LoginFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.<span class="keyword">annotation</span>.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.FilterRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.DispatcherServlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对应web.xml中的所有设置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebXmlConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = <span class="meta-string">"LoginFilter"</span>)</span></span><br><span class="line">    <span class="keyword">public</span> Filter getLoginFilter() &#123;</span><br><span class="line">        <span class="keyword">return</span> new LoginFilter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DispatcherServlet dispatcherServlet;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    新的springboot不需要再设置servlet -&gt; DispatcherServlet ,默认会拦截请求交给DispatcherServlet</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    @Bean</span></span><br><span class="line"><span class="comment">    public ServletRegistrationBean defaultServletRegistration() &#123;</span></span><br><span class="line"><span class="comment">        ServletRegistrationBean registrationBean = new ServletRegistrationBean();</span></span><br><span class="line"><span class="comment">        registrationBean.setServlet(dispatcherServlet);</span></span><br><span class="line"><span class="comment">        registrationBean.addUrlMappings("*.ajax");</span></span><br><span class="line"><span class="comment">        return registrationBean;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean loginFilterRegistration() &#123;</span><br><span class="line">        FilterRegistrationBean registrationBean = new FilterRegistrationBean();</span><br><span class="line">        registrationBean.setFilter(getLoginFilter());</span><br><span class="line">        registrationBean.setName(<span class="string">"LoginFilter"</span>);</span><br><span class="line">        registrationBean.addUrlPatterns(<span class="string">"*.html"</span>, <span class="string">"*.ajax"</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>　<strong>从上面文件可以看到 ，通过<code>@Configuration</code>+<code>@Import</code>将xml转化成了容易理解的Java 。所以不是不需要配置，而是规范化、简单化的配置，而且启动方式上也简便不少。</strong> <br><br>　<strong>SpringBoot 将原来一些固定的启动方式打包在了一起 ，包含了很多自动化的配置 （<a href="http://blog.csdn.net/xiaoyu411502/article/details/52770723" target="_blank" rel="noopener">@Enable*注解系列</a>）; 采用易读写的yaml和Java，摒弃xml（真的头晕）。</strong> </p>
<h1 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h1><p><code>Application.main()</code></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><blockquote>
</blockquote>
<p>GitHub示例 <a href="https://github.com/Anddd7/SSM-SpringBoot-Starter" target="_blank" rel="noopener">Anddd7/SSM-SpringBoot-Starter</a>`</p>
<p>　如果要添加webapp（网页静态资源），重命名为resources放在源目录下 （SpringBoot默认查找resources/static/public作为静态目录）。熟练过后 ，配置一个可用的Spring要比之前快得多 ，而且配置文件减少 ，项目目录结构清晰不少 。 <br><br>　不过对Spring不熟悉 ，没有一条一条配过xml的入门者 ，这种一键式配置推荐使用不推荐学习 。封装太深 ，很难理解每一步的意义 ，所以使用过后还是对照xml一步步探究Spring所做的事 ，<strong>共勉</strong> 。</p>
<p>　<strong>Next ，SpringBoot原理和Spring源码</strong></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-02-09</span><i class="fa fa-tag"></i></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,https://anddd7.github.io/legacy/SpringBoot + MyBatis/,Anddd7's Planet,SpringBoot + MyBatis 重构 Web 应用,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/legacy/Maven-POM/" title="Maven-详解pom.xml内容及用法">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/legacy/SSO-Single Sign On/" title="单点登录SSO（Single Sign On）">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>
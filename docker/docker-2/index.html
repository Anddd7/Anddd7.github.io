<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        （二）Docker基本操作 - undefined
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i>  </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/assets/avatar.jpeg" />
        </div>
        <div class="name">
            <i>Anddd7</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装和运行Docker"><span class="toc-text">安装和运行Docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取镜像"><span class="toc-text">获取镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开始Docker之旅"><span class="toc-text">开始Docker之旅</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hello-Docker"><span class="toc-text">Hello Docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修改镜像"><span class="toc-text">修改镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Dockerfile实践"><span class="toc-text">Dockerfile实践</span></a></li></ol></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i>  </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        （二）Docker基本操作
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2018-08-10 00:00:00</span></span>
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h2 id="安装和运行Docker"><a href="#安装和运行Docker" class="headerlink" title="安装和运行Docker"></a>安装和运行Docker</h2><blockquote>
<p>Docker底层依赖Linux内核技术，因此在Window和MacOS上使用的Docker，是由Docker应用程序虚拟了一个Linux虚拟机(轻量级)，然后将Docker CLI安装在宿主机上与之交互。</p>
<pre><code class="bash">$ docker -v # 查看docker版本，检查是否安装成功
Docker version 18.03.1-ce, build 9ee9f40
</code></pre>
</blockquote>
<h2 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h2><p>镜像是Docker容器的基础，想要启动一个容器需要先创建/获得它的镜像。</p>
<ul>
<li>镜像:<ul>
<li>可用于创建容器的只读模版</li>
<li>基于分层文件系统构建</li>
<li>每一层都在其上一层文件系统的基础上增加或替换部分内容</li>
</ul>
</li>
<li>镜像通常包含：<ul>
<li>一个轻量级的操作系统发行版</li>
<li>相关依赖</li>
<li>单个应用或服务</li>
</ul>
</li>
<li>你可以在公有仓库中找到镜像(例如：Docker Hub)<ul>
<li>你也可以打造自己的镜像：Dockerfile</li>
</ul>
</li>
</ul>
<h2 id="开始Docker之旅"><a href="#开始Docker之旅" class="headerlink" title="开始Docker之旅"></a>开始Docker之旅</h2><p>我们主要使用一个<code>busybox</code>镜像，它包含了一个基本的Linux操作系统和一些简单的指令，能帮助我们快速掌握Docker的基础用法。</p>
<h3 id="Hello-Docker"><a href="#Hello-Docker" class="headerlink" title="Hello Docker"></a>Hello Docker</h3><ol>
<li>拉取镜像：docker会向注册过的仓库(本地或是远程)拉取目标镜像<pre><code class="bash">$ docker pull busybox
Using default tag: latest
latest: Pulling from library/busybox
8c5a7da1afbc: Pull complete
Digest: sha256:cb63aa0641a885f54de20f61d152187419e8f6b159ed11a251a09d115fdff9bd
Status: Downloaded newer image for busybox:latest
</code></pre>
</li>
</ol>
<ol start="2">
<li>查看镜像<pre><code class="bash">$ docker images
REPOSITORY                                  TAG                 IMAGE ID            CREATED             SIZE
busybox                                     latest              e1ddd7948a1c        35 hours ago        1.16MB
</code></pre>
</li>
</ol>
<ol start="3">
<li>启动容器：并告知容器打印‘Hello Docker’<pre><code class="bash">$ docker run busybox echo &quot;Hello Docker&quot;
Hello Docker
</code></pre>
<blockquote>
<p><code>docker run [image] [command]</code>：启动一个容器并执行指定命令</p>
</blockquote>
</li>
</ol>
<ol start="4">
<li>启动交互式容器：打开容器内的终端并进行交互<pre><code class="bash">$ docker run -it busybox sh
/ # echo &#39;Hello Docker&#39;
Hello Docker
</code></pre>
<blockquote>
<ul>
<li>-t：在新容器内指定一个伪终端或终端</li>
<li>-i：允许你对容器内的标准输入(STDIN)进行交互</li>
</ul>
</blockquote>
</li>
</ol>
<ol start="5">
<li>后台启动容器，发送指令给后台容器<pre><code class="bash">$ docker run -dit busybox
0395c8f9ac04626d96cbef7860af59c1e062490f4e0f311ed94b25e4b18b06b4
$ docker exec 0395c8f9ac04626d96cbef7860af59c1e062490f4e0f311ed94b25e4b18b06b4 echo &quot;Hello Docker&quot;
Hello Docker
$ docker exec -it 0395c8f9ac04626d96cbef7860af59c1e062490f4e0f311ed94b25e4b18b06b4 sh
/ # echo &#39;Hello Docker&#39;
Hello Docker
</code></pre>
<blockquote>
<p><code>docker exec [Container-ID/Name] [command]</code>：向已启动的容器发送指定命令<br><code>docker run --name [Container-Name] [image]</code>：设置容器名称，方便按容器名进行操作</p>
</blockquote>
</li>
</ol>
<ol start="6">
<li>查看容器<br><code>`</code>bash<br>$ docker ps # 查看运行的容器<br>$ docker ps -a # 查看所有容器<br>$ docker images # 查看所有镜像</li>
</ol>
<p>$ docker start [Container ID/Name] # 启动一个已关闭的容器<br>$ docker kill [Container ID/Name] # 关闭一个运行中的容器<br>$ docker logs [Container ID/Name] # 查看指定容器的log</p>
<p>$ docker rm $(docker ps -a -q) # 删除所有容器<br>$ docker rmi $(docker images -q) # 删除所有镜像<br>$ docker rmi $(docker images -f “dangling=true” -q) # 删除’悬空’的镜像</p>
<pre><code>


0. 其他应用
&gt; Docker Hub中有非常多的镜像，有Linux各种发行版的操作系统，还有Http Server、数据库等打包好的应用。你可以很快的拉取一个MongoDB镜像，然后在本机上运行容器并提供服务，而不需要进行繁琐的安装和环境配置。



### Dockerfile

虽然官方镜像很多，但我们仍希望自定义我们的容器来提供一些额外功能。例如，我希望启动容器能自动打印Hello Docker。前面提到Docker的镜像是通过分层结构存储的，我们需要在已有的镜像上新增一层用来支持我们的改动 - Dockerfile。

**Dockerfile** 是用来描述镜像构建过程中的所有操作，包括基础镜像、拉取文件、执行指令等。
``` Dockerfile
FROM busybox # 指定镜像基于哪个基础镜像
MAINTAINER author # 设置该镜像的作者
ENV version=0.0.1 # 设置环境变量
USER ... # 镜像正在运行时设置一个UID
WORKDIR ... # 指定RUN、CMD与ENTRYPOINT命令的工作目录
VOLUME ... | [...,...] # 设置容器内的匿名卷
RUN [...,...] # 在shell或者exec的环境下执行的命令, RUN指令会在新创建的镜像上添加新的层面, 接下来提交的结果用在Dockerfile的下一条指令中
ADD &lt;source&gt; &lt;destination&gt; # 添加文件指令，source可以是远程的地址
COPY &lt;source&gt; &lt;destination&gt; # 复制文件指令
EXPOSE 80 # 指定容器在运行时监听的端口
ENTRYPOINT [&quot;sh&quot;] # 指定容器的启动程序及参数
CMD ... # (唯一，最后一条生效)容器启动程序的参数，可以被docker run [IMAGE] [COMMAND]替换
</code></pre><p>特别说明<code>CMD</code>：<br><code>CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</code>：运行一个可执行的文件并提供参数<br><code>CMD [&quot;param1&quot;,&quot;param2&quot;]</code>：为ENTRYPOINT指定参数<br><code>CMD command param1 param2</code>：以”/bin/sh -c”的方法执行的命令</p>
<h3 id="修改镜像"><a href="#修改镜像" class="headerlink" title="修改镜像"></a>修改镜像</h3><ol>
<li>创建Dockerfile：需要完成这个功能，我们只需要在<code>busybox</code>容器启动时，默认执行打印动作即可。<pre><code class="Dockfile">FROM busybox
# 1.
# CMD [&quot;echo&quot;,&quot;Hello World&quot;] # 仅打印
# 2.
# CMD echo &quot;Hello World&quot; &amp; sh # 打印后自动开启sh
CMD [&quot;sh&quot;,&quot;-c&quot;,&quot;echo &#39;Hello World&#39; &amp; sh&quot;] # 同上，打印后自动开启sh
</code></pre>
</li>
</ol>
<ol start="2">
<li>生成镜像<pre><code class="bash">$ docker build -f Dockerfile-1 -t anddd7/busybox:latest .
Sending build context to Docker daemon  2.048kB
Step 1/2 : FROM busybox
---&gt; e1ddd7948a1c
Step 2/2 : CMD [&quot;sh&quot;,&quot;-c&quot;,&quot;echo &#39;Hello World&#39; &amp; sh&quot;]
---&gt; Running in 85c38bf6ae46
Removing intermediate container 85c38bf6ae46
---&gt; 1ff726e635ac
Successfully built 1ff726e635ac
Successfully tagged anddd7/busybox:latest
</code></pre>
<blockquote>
<ul>
<li>-f：Dockerfile文件(当名称不是默认的Dockerfile时使用)</li>
<li>-t：镜像名称+tag标签<br>可以看到，build过程中引用/生成了不同的层（包括busybox镜像和中间层）。使用<code>docker images</code>和<code>docker history</code>进行查看。</li>
</ul>
</blockquote>
</li>
</ol>
<ol start="3">
<li>启动容器<pre><code class="bash">$ docker run -it anddd7/busybox
Hello World
/ #
</code></pre>
</li>
</ol>
<h4 id="Dockerfile实践"><a href="#Dockerfile实践" class="headerlink" title="Dockerfile实践"></a>Dockerfile实践</h4><ul>
<li>保持常见的指令像MAINTAINER以及从上至下更新Dockerfile命令;</li>
<li>当构建镜像时使用可理解的标签，以便更好地管理镜像;</li>
<li>避免在Dockerfile中映射公有端口;</li>
<li>CMD与ENTRYPOINT命令请使用数组语法。</li>
<li>..</li>
</ul>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>
    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span> PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span> UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = ""
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
